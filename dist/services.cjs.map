{"version":3,"sources":["../src/services/index.ts","../src/services/BaseService.ts"],"sourcesContent":["export * from './BaseService';\n","import { SupabaseClient } from '@supabase/supabase-js';\n\n/**\n * Unified query options for database operations\n */\nexport interface QueryOptions {\n  select?: string;\n  orderBy?: string;\n  ascending?: boolean;\n  filters?: Record<string, any>;\n  limit?: number;\n  offset?: number;\n  dateRange?: {\n    startDate?: string;\n    endDate?: string;\n    dateField?: string;\n  };\n}\n\n/**\n * Pagination options\n */\nexport interface PaginationOptions {\n  page?: number;\n  perPage?: number;\n}\n\n/**\n * Advanced Base Service Class\n * Combines the best patterns from crm_demo, tracc, and scheduler_demo\n * Provides comprehensive CRUD operations with advanced filtering, pagination, and error handling\n */\nexport class BaseService {\n  protected client: SupabaseClient;\n  protected tableName: string;\n\n  constructor(client: SupabaseClient, tableName: string) {\n    this.client = client;\n    this.tableName = tableName;\n  }\n\n  /**\n   * Get all records with advanced filtering and pagination\n   */\n  async getAll(options: QueryOptions = {}): Promise<any[]> {\n    try {\n      let query = this.client\n        .from(this.tableName)\n        .select(options.select || '*')\n        .order(options.orderBy || 'created_at', { ascending: options.ascending !== false });\n\n      // Apply filters\n      if (options.filters) {\n        Object.entries(options.filters).forEach(([key, value]) => {\n          if (value !== null && value !== undefined && value !== '') {\n            if (Array.isArray(value)) {\n              query = query.in(key, value);\n            } else if (typeof value === 'string' && value.includes('%')) {\n              query = query.like(key, value);\n            } else {\n              query = query.eq(key, value);\n            }\n          }\n        });\n      }\n\n      // Apply date range filter\n      if (options.dateRange) {\n        const { startDate, endDate, dateField = 'created_at' } = options.dateRange;\n        if (startDate) {\n          query = query.gte(dateField, `${startDate}T00:00:00.000Z`);\n        }\n        if (endDate) {\n          query = query.lte(dateField, `${endDate}T23:59:59.999Z`);\n        }\n      }\n\n      // Apply pagination\n      if (options.limit) {\n        query = query.limit(options.limit);\n      }\n      if (options.offset) {\n        query = query.range(options.offset, options.offset + (options.limit || 10) - 1);\n      }\n\n      const { data, error } = await query;\n\n      if (error) {\n        throw new Error(this.handleSupabaseError(error, `${this.tableName}.getAll`));\n      }\n\n      return data || [];\n    } catch (error: any) {\n      throw new Error(`Failed to fetch ${this.tableName}: ${error.message}`);\n    }\n  }\n\n  /**\n   * Get paginated records with total count\n   */\n  async getPaginated(options: QueryOptions & PaginationOptions = {}): Promise<{\n    data: any[];\n    total: number;\n    page: number;\n    perPage: number;\n    totalPages: number;\n  }> {\n    const page = options.page || 1;\n    const perPage = options.perPage || 10;\n    const offset = (page - 1) * perPage;\n\n    // Get total count\n    const totalCount = await this.count(options.filters);\n\n    // Get paginated data\n    const data = await this.getAll({\n      ...options,\n      limit: perPage,\n      offset\n    });\n\n    return {\n      data,\n      total: totalCount,\n      page,\n      perPage,\n      totalPages: Math.ceil(totalCount / perPage)\n    };\n  }\n\n  /**\n   * Get a record by ID\n   */\n  async getById(id: string | number, select = '*'): Promise<any> {\n    try {\n      const { data, error } = await this.client\n        .from(this.tableName)\n        .select(select)\n        .eq('id', id)\n        .single();\n\n      if (error) {\n        throw new Error(this.handleSupabaseError(error, `${this.tableName}.getById`));\n      }\n\n      return data;\n    } catch (error: any) {\n      throw new Error(`Failed to fetch ${this.tableName} by ID: ${error.message}`);\n    }\n  }\n\n  /**\n   * Create a new record\n   */\n  async create(data: Record<string, any>): Promise<any> {\n    try {\n      const { data: result, error } = await this.client\n        .from(this.tableName)\n        .insert(data)\n        .select()\n        .single();\n\n      if (error) {\n        throw new Error(this.handleSupabaseError(error, `${this.tableName}.create`));\n      }\n\n      return result;\n    } catch (error: any) {\n      throw new Error(`Failed to create ${this.tableName}: ${error.message}`);\n    }\n  }\n\n  /**\n   * Update a record\n   */\n  async update(id: string | number, data: Record<string, any>): Promise<any> {\n    try {\n      const { data: result, error } = await this.client\n        .from(this.tableName)\n        .update(data)\n        .eq('id', id)\n        .select()\n        .single();\n\n      if (error) {\n        throw new Error(this.handleSupabaseError(error, `${this.tableName}.update`));\n      }\n\n      return result;\n    } catch (error: any) {\n      throw new Error(`Failed to update ${this.tableName}: ${error.message}`);\n    }\n  }\n\n  /**\n   * Delete a record\n   */\n  async delete(id: string | number): Promise<void> {\n    try {\n      const { error } = await this.client\n        .from(this.tableName)\n        .delete()\n        .eq('id', id);\n\n      if (error) {\n        throw new Error(this.handleSupabaseError(error, `${this.tableName}.delete`));\n      }\n    } catch (error: any) {\n      throw new Error(`Failed to delete ${this.tableName}: ${error.message}`);\n    }\n  }\n\n  /**\n   * Bulk delete records\n   */\n  async bulkDelete(ids: (string | number)[]): Promise<void> {\n    try {\n      const { error } = await this.client\n        .from(this.tableName)\n        .delete()\n        .in('id', ids);\n\n      if (error) {\n        throw new Error(this.handleSupabaseError(error, `${this.tableName}.bulkDelete`));\n      }\n    } catch (error: any) {\n      throw new Error(`Failed to bulk delete ${this.tableName}: ${error.message}`);\n    }\n  }\n\n  /**\n   * Count records with optional filters\n   */\n  async count(filters?: Record<string, any>): Promise<number> {\n    try {\n      let query = this.client\n        .from(this.tableName)\n        .select('*', { count: 'exact', head: true });\n\n      if (filters) {\n        Object.entries(filters).forEach(([key, value]) => {\n          if (value !== null && value !== undefined && value !== '') {\n            if (Array.isArray(value)) {\n              query = query.in(key, value);\n            } else {\n              query = query.eq(key, value);\n            }\n          }\n        });\n      }\n\n      const { count, error } = await query;\n\n      if (error) {\n        throw new Error(this.handleSupabaseError(error, `${this.tableName}.count`));\n      }\n\n      return count || 0;\n    } catch (error: any) {\n      throw new Error(`Failed to count ${this.tableName}: ${error.message}`);\n    }\n  }\n\n  /**\n   * Search records with text search\n   */\n  async search(searchTerm: string, searchFields: string[] = ['name'], options: QueryOptions = {}): Promise<any[]> {\n    try {\n      let query = this.client\n        .from(this.tableName)\n        .select(options.select || '*');\n\n      // Build text search query\n      if (searchFields.length === 1) {\n        query = query.ilike(searchFields[0], `%${searchTerm}%`);\n      } else {\n        // For multiple fields, use OR condition\n        const orConditions = searchFields.map(field => `${field}.ilike.%${searchTerm}%`).join(',');\n        query = query.or(orConditions);\n      }\n\n      // Apply additional filters\n      if (options.filters) {\n        Object.entries(options.filters).forEach(([key, value]) => {\n          if (value !== null && value !== undefined && value !== '') {\n            query = query.eq(key, value);\n          }\n        });\n      }\n\n      query = query.order(options.orderBy || 'created_at', { ascending: options.ascending !== false });\n\n      if (options.limit) {\n        query = query.limit(options.limit);\n      }\n\n      const { data, error } = await query;\n\n      if (error) {\n        throw new Error(this.handleSupabaseError(error, `${this.tableName}.search`));\n      }\n\n      return data || [];\n    } catch (error: any) {\n      throw new Error(`Failed to search ${this.tableName}: ${error.message}`);\n    }\n  }\n\n  /**\n   * Handle Supabase errors with user-friendly messages\n   */\n  protected handleSupabaseError(error: any, context = ''): string {\n    // User-friendly error messages\n    if (error.code === '23505') {\n      return 'This record already exists';\n    } else if (error.code === '23503') {\n      return 'Cannot perform this operation due to related records';\n    } else if (error.code === 'PGRST116') {\n      return 'No records found';\n    } else if (error.message?.includes('JWT')) {\n      return 'Authentication error. Please refresh the page';\n    }\n    \n    return error.message || 'An unexpected error occurred';\n  }\n}\n"],"mappings":"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","names":[]}